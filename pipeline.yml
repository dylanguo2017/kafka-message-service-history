resources:
- name: kafka-message-service #TODO: change here and replace throughout file
  type: git
  #https://github.homedepot.com/EnterpriseCustomerCommunication/
  source: 
    uri: git@github.homedepot.com:EnterpriseCustomerCommunication/kafka-message-service.git #TODO: link to your source code repo
    git_config:
     - name: http.sslVerify
       value: false
    disable_ci_skip: false
    branch: develop
    private_key: {{github-private-key}}
    check_every: 24h
    webhook_token: {{webhook_token}}
- name: git(deployments) #TODO: change to your deployments repo
  type: git
  source:
    uri: git@github.homedepot.com:EnterpriseCustomerCommunication/ecc-deployments.git #TODO: link to your deployments repo
    branch: master
    private_key: {{github-private-key}}
  check_every: 24h
- name: ci
  type: git
  source:
    uri: git@github.homedepot.com:ci-cd/concourse-common.git
    branch: master
    private_key: {{github-private-key}}
    #tag_filter: "1.*"
  check_every: 24h

- name: slack
  type: slack-notification
  source:
    url: {{slack-webhook-url}}
  check_every: 5m

resource_types:
  - name: slack-notification
    type: docker-image
    source:
      repository: cfcommunity/slack-notification-resource
      registry_mirror: https://docker.artifactory.homedepot.com
    check_every: 5m
    
jobs:
- name: Version
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
  - get: ci
  - task: Version and Tag
    file: ci/concourse/github_version_and_tag.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
    on_failure:
      put: slack
      params:
        #TODO replace below channel name with your channel
        channel: "#ecc-dev"
        username: concourse
        icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
        text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed versioning! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
- name: Unit Test
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
    passed: [Version]
  - get: ci
  - task: SQH Started
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: junit
      SQH_JOB_NAME: UNIT-TEST
      SQH_STATUS: STARTED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: junit
          SQH_JOB_NAME: UNIT-TEST
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: Unit Test
    file: ci/concourse/maven_test_sqp.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      TEST_OUTPUT_DIRECTORY: target/surefire-reports
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      ENVIRONMENT: dev
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: junit
          SQH_JOB_NAME: UNIT-TEST
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed testing! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  
  - task: SQH Complete
    file: ci/concourse/sqh_with_results.yml
    input_mapping:
      code-repo: kafka-message-service #TODO: change code-repo to your source repo
      test-results: test
    params:
      SQH_BUILD_NAME: junit
      SQH_JOB_NAME: UNIT-TEST
      SQH_STATUS: COMPLETED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
        #keeps failed stage from spinning forever
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: junit
          SQH_JOB_NAME: UNIT-TEST
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
- name: Label Stories
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
    passed: [Unit Test]
  - get: ci
  - task: Label Stories (Pivotal Tracker)
    file: ci/concourse/tracker_label_stories.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
    on_failure:
      put: slack
      params:
        #TODO replace below channel name with your channel
        channel: "#ecc-dev"
        username: concourse
        icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
        text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed labeling stories in Tracker! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
- name: Code Quality
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
    passed: [Unit Test]
  - get: ci
  - task: SQH Started
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: sonar
      SQH_JOB_NAME: CODE-QUALITY
      SQH_STATUS: STARTED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: sonar
          SQH_JOB_NAME: CODE-QUALITY
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: Sonar
    file: ci/concourse/sonar_maven.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: sonar
          SQH_JOB_NAME: CODE-QUALITY
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed submitting code to Sonar! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: SQH Complete
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: sonar
      SQH_JOB_NAME: CODE-QUALITY
      SQH_STATUS: COMPLETED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: sonar
          SQH_JOB_NAME: CODE-QUALITY
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
- name: Security Scan
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
    passed: [Unit Test]
  - get: ci
  - task: SQH Started
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: fortify
      SQH_JOB_NAME: SECURITY-SCAN
      SQH_STATUS: STARTED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: fortify
          SQH_JOB_NAME: SECURITY-SCAN
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: Fortify
    file: ci/concourse/fortify_security_scan.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      FORTIFY_TOKEN: {{fortify-token}}
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: fortify
          SQH_JOB_NAME: SECURITY-SCAN
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed submitting security scan! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: SQH Complete
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: fortify
      SQH_JOB_NAME: SECURITY-SCAN
      SQH_STATUS: COMPLETED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: fortify
          SQH_JOB_NAME: SECURITY-SCAN
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"


- name: Build Artifact
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
    passed: [Code Quality]
  - get: ci
  - task: SQH Started
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: artifactory
      SQH_JOB_NAME: ARTIFACT
      SQH_STATUS: STARTED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: artifactory
          SQH_JOB_NAME: ARTIFACT
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: build
    file: ci/concourse/maven_build.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      DIST_DIRECTORY: target
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: artifactory
          SQH_JOB_NAME: ARTIFACT
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed building! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: Upload to Artifactory
    file: ci/concourse/artifactory_upload_artifact.yml
    input_mapping: {code-repo: kafka-message-service, dist: dist} #TODO: change code-repo to your source repo
    params:
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      ARTIFACTORY_TOKEN: {{artifactory-token}}
      
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: artifactory
          SQH_JOB_NAME: ARTIFACT
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed upload to Artifactory! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: SQH Completed
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: artifactory
      SQH_JOB_NAME: ARTIFACT
      SQH_STATUS: COMPLETED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: artifactory
          SQH_JOB_NAME: ARTIFACT
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"

- name: Deploy
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
    passed: [Build Artifact]
  - get: git(deployments)
  - get: ci
  - task: SQH Started
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: pcf
      SQH_JOB_NAME: DEPLOY-dev
      SQH_STATUS: STARTED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: pcf
          SQH_JOB_NAME: DEPLOY-dev
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: Deploy
    file: ci/concourse/cloud_foundry_deploy.yml
    input_mapping: {code-repo: kafka-message-service, deployments-repo: git(deployments)} #TODO: change code-repo to your source repo
    params:
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      DEPLOYMENT_USER: {{deployment-user}}
      DEPLOYMENT_PWD: {{deployment-pwd}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: pcf
          SQH_JOB_NAME: DEPLOY-dev
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed deploying to PCF! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
  - task: SQH Completed
    file: ci/concourse/sqh.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      SQH_BUILD_NAME: pcf
      SQH_JOB_NAME: DEPLOY-dev
      SQH_STATUS: COMPLETED
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
      token: {{QUALITYHUB_TOKEN}}
    on_failure:
      aggregate:
      - task: SQH fail
        file: ci/concourse/sqh.yml
        input_mapping:
          code-repo: kafka-message-service #TODO: change code-repo to your source repo
          test-results: test
        params:
          SQH_BUILD_NAME: pcf
          SQH_JOB_NAME: DEPLOY-dev
          SQH_STATUS: FAILED
          ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
          GITHUB_PRIVATE_KEY: {{github-private-key}}
          GITHUB_TOKEN: {{github-token}}
          TRACKER_TOKEN: {{tracker-token}}
          SLACK_WEBHOOK_URL: {{slack-webhook-url}}
          token: {{QUALITYHUB_TOKEN}}
      - put: slack
        params:
          #TODO replace below channel name with your channel
          channel: "#ecc-dev"
          username: concourse
          icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
          text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed communicating with SQ Hub! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"
          

- name: Release Notes
  max_in_flight: 1
  plan:
  - get: kafka-message-service #TODO: change to your source repo
    trigger: true
    passed: [Deploy]
  - get: ci
  - task: Slack Release Notes
    file: ci/concourse/slack_release_notes.yml
    input_mapping: {code-repo: kafka-message-service} #TODO: change code-repo to your source repo
    params:
      GITHUB_PRIVATE_KEY: {{github-private-key}}
      GITHUB_TOKEN: {{github-token}}
      ENVIRONMENT: dev #TODO: use the appropriate environment name from your buildConfig that matches
      TRACKER_TOKEN: {{tracker-token}}
      SLACK_WEBHOOK_URL: {{slack-webhook-url}}
    on_failure:
      put: slack
      params:
        #TODO replace below channel name with your channel
        channel: "#ecc-dev"
        username: concourse
        icon_url: https://avatars1.githubusercontent.com/u/7809479?v=3&s=200
        text: "$BUILD_PIPELINE_NAME/$BUILD_JOB_NAME failed shipping release notes to slack! <$ATC_EXTERNAL_URL/teams/$BUILD_TEAM_NAME/pipelines/$BUILD_PIPELINE_NAME/jobs/$BUILD_JOB_NAME/builds/$BUILD_NAME|  Click for details.>"

